app-id: org.gajim.Gajim
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: gajim
finish-args:
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --system-talk-name=org.freedesktop.login1
  - --talk-name=org.mpris.MediaPlayer2.*
  # Automatic status
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.gnome.Mutter.IdleMonitor
  # Keyring
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.kde.kwalletd5
  # Notifications
  - --talk-name=org.freedesktop.Notifications
  # tray/status icon
  - --talk-name=org.kde.StatusNotifierWatcher
  # GnuPG
  - --filesystem=~/.gnupg
  - --filesystem=xdg-run/gnupg
  # gpu acceleration
  - --device=dri
  # extensions
  - --env=PYTHONPATH=/app/plugins/site-packages
  - --env=GI_TYPELIB_PATH=/app/lib/girepository-1.0:/app/plugins/lib/girepository-1.0

add-extensions:
  org.gajim.Gajim.Plugin:
    directory: plugins
    merge-dirs: lib;site-packages
    add-ld-path: lib
    subdirectories: true
    no-autodownload: true
    autodelete: true

build-options:
  env:
    PIP_PREFIX: /app
    PIP_DISABLE_PIP_VERSION_CHECK: "1"

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/gtk-doc
  - /share/man
  - '*.a'
  - '*.la'

modules:

  - name: python3-pycparser
    buildsystem: simple
    build-commands:
      - pip3 install pycparser-3.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/0c/c3/44f3fbbfa403ea2a7c779186dc20772604442dde72947e7d01069cbe98e3/pycparser-3.0-py3-none-any.whl
        sha256: b727414169a36b7d524c1c3e31839a521725078d7b2ff038656844266160a992

  - name: python3-cffi
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/eb/56/b1ba7935a17738ae8453301356628e8147c79dbb825bcbc73dc7401f9846/cffi-2.0.0.tar.gz
        sha256: 44d1b5909021139fe36001ae048dbdde8214afa20200eda0f64c068cac5d5529

  - name: python3-idna
    buildsystem: simple
    build-commands:
      - pip3 install idna-3.11-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/0e/61/66938bbb5fc52dbdf84594873d5b51fb1f7c7794e9c0f5bd885f30bc507b/idna-3.11-py3-none-any.whl
        sha256: 771a87f49d9defaf64091e6e6fe9c18d4833f140bd19464795bc32d966ca37ea

  - name: python3-cryptography
    buildsystem: simple
    only-arches:
      - aarch64
    build-commands:
      - pip3 install cryptography-45.0.7-cp311-abi3-manylinux_2_34_aarch64.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cp311/c/cryptography/cryptography-45.0.7-cp311-abi3-manylinux_2_34_aarch64.whl
        sha256: 8978132287a9d3ad6b54fcd1e08548033cc09dc6aacacb6c004c73c3eb5d3ac3

  - name: python3-cryptography
    buildsystem: simple
    only-arches:
      - x86_64
    build-commands:
      - pip3 install cryptography-45.0.7-cp311-abi3-manylinux_2_34_x86_64.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cp311/c/cryptography/cryptography-45.0.7-cp311-abi3-manylinux_2_34_x86_64.whl
        sha256: b6a0e535baec27b528cb07a119f321ac024592388c5681a5ced167ae98e9fff3

  - name: python3-jeepney
    buildsystem: simple
    build-commands:
      - pip3 install jeepney-0.9.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/b2/a3/e137168c9c44d18eff0376253da9f1e9234d0239e0ee230d2fee6cea8e55/jeepney-0.9.0-py3-none-any.whl
        sha256: 97e5714520c16fc0a45695e5365a2e11b81ea79bba796e26f9f1d178cb182683

  - name: python3-secretstorage
    buildsystem: simple
    build-commands:
      - pip3 install secretstorage-3.5.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/b7/46/f5af3402b579fd5e11573ce652019a67074317e18c1935cc0b4ba9b35552/secretstorage-3.5.0-py3-none-any.whl
        sha256: 0ce65888c0725fcb2c5bc0fdb8e5438eece02c523557ea40ce0703c266248137

  # jaraco.classes dependency
  - name: python3-more-itertools
    buildsystem: simple
    build-commands:
      - pip3 install more_itertools-10.8.0-py3-none-any.whl
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a4/8e/469e5a4a2f5855992e425f3cb33804cc07bf18d48f2db061aec61ce50270/more_itertools-10.8.0-py3-none-any.whl
        sha256: 52d4362373dcf7c52546bc4af9a86ee7c4579df9a8dc268be0a2f949d376cc9b

  # keyring dependency
  - name: python3-jaraco.classes
    buildsystem: simple
    build-commands:
      - pip3 install jaraco.classes-3.4.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7f/66/b15ce62552d84bbfcec9a4873ab79d993a1dd4edb922cbfccae192bd5b5f/jaraco.classes-3.4.0-py3-none-any.whl
        sha256: f662826b6bed8cace05e7ff873ce0f9283b5c924470fe664fff1c2f00f581790

  - name: python3-jaraco.context
    buildsystem: simple
    build-commands:
      - pip3 install jaraco_context-6.1.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/8d/48/aa685dbf1024c7bd82bede569e3a85f82c32fd3d79ba5fea578f0159571a/jaraco_context-6.1.0-py3-none-any.whl
        sha256: a43b5ed85815223d0d3cfdb6d7ca0d2bc8946f28f30b6f3216bda070f68badda

  - name: python3-jaraco.functools
    buildsystem: simple
    build-commands:
      - pip3 install jaraco_functools-4.4.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/fd/c4/813bb09f0985cb21e959f21f2464169eca882656849adf727ac7bb7e1767/jaraco_functools-4.4.0-py3-none-any.whl
        sha256: 9eec1e36f45c818d9bf307c8948eb03b2b56cd44087b3cdc989abca1f20b9176

  - name: python3-keyring
    buildsystem: simple
    build-commands:
      - pip3 install keyring-25.7.0-py3-none-any.whl
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/81/db/e655086b7f3a705df045bf0933bdd9c2f79bb3c97bfef1384598bb79a217/keyring-25.7.0-py3-none-any.whl
        sha256: be4a0b195f149690c166e850609a477c532ddbfbaed96a404d4e43f8d5e2689f

  - name: python3-css-parser
    buildsystem: simple
    build-commands:
      - pip3 install css_parser-1.0.10-py2.py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7c/01/4a633580393fa23e17c22f5782886e898c0fdbdb9e77736552a7a12637b5/css_parser-1.0.10-py2.py3-none-any.whl
        sha256: d2e955a114829f0a327cc5535c2e65fe2e40b883b892881017d419a3b6dd05b7

  - name: python3-precis_i18n
    buildsystem: simple
    build-commands:
      - pip3 install precis_i18n-1.1.2-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c3/9b/b68be6845faedb6fa33c4ffda7741467a8e8aabff82c6a941a0ba2785c3d/precis_i18n-1.1.2-py3-none-any.whl
        sha256: 8e6cce33bdd8cb6289b9e85cdd7be74c30a1111cadb9d759492349c8c10b0840

  # GSound dependency
  - shared-modules/libcanberra/libcanberra.json

  - name: gsound
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gsound/1.0/gsound-1.0.3.tar.xz
        sha256: ca2d039e1ebd148647017a7f548862350bc9af01986d39f10cfdc8e95f07881a

  - name: libspelling
    buildsystem: meson
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libspelling/0.4/libspelling-0.4.9.tar.xz
        sha256: d093fd35ae0f1c98fb58876505287fc0a885e47da9d2411d6d7cd595f34d4ebf

  - name: farstream
    rm-configure: true
    sources:
      - type: archive
        url: https://freedesktop.org/software/farstream/releases/farstream/farstream-0.2.9.tar.gz
        sha256: cb7d112433cf7c2e37a8ec918fb24f0ea5cb293cfa1002488e431de26482f47b
      - type: patch
        path: farstream-make-4.3.patch

  # pillow dependency
  - name: python3-pybind11
    buildsystem: simple
    build-commands:
      - pip3 install pybind11-3.0.2-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/88/c5/e98d9c51f3d5300d5e40ad9037dd6b3b60736fd02ab68dcc98c96be7592d/pybind11-3.0.2-py3-none-any.whl
        sha256: f8a6500548919cc33bcd220d5f984688326f574fa97f1107f2f4fdb4c6fb019f

  - name: python3-pillow
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/1f/42/5c74462b4fd957fcd7b13b04fb3205ff8349236ea74c7c375766d6c82288/pillow-12.1.1.tar.gz
        sha256: 9ad8fa5937ab05218e2b6a4cff30295ad35afd2f83ac592e68c0d871bb0fdbc4

  # httpx dependencies
  - name: python3-truststore
    buildsystem: simple
    build-commands:
      - pip3 install truststore-0.10.4-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/19/97/56608b2249fe206a67cd573bc93cd9896e1efb9e98bce9c163bcdc704b88/truststore-0.10.4-py3-none-any.whl
        sha256: adaeaecf1cbb5f4de3b1959b42d41f6fab57b2b1666adb59e89cb0b53361d981

  # h2 dependencies
  - name: python3-hpack
    buildsystem: simple
    build-commands:
      - pip3 install hpack-4.1.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/07/c6/80c95b1b2b94682a72cbdbfb85b81ae2daffa4291fbfa1b1464502ede10d/hpack-4.1.0-py3-none-any.whl
        sha256: 157ac792668d995c657d93111f46b4535ed114f0c9c8d672271bbec7eae1b496

  - name: python3-hyperframe
    buildsystem: simple
    build-commands:
      - pip3 install hyperframe-6.1.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/48/30/47d0bf6072f7252e6521f3447ccfa40b421b6824517f82854703d0f5a98b/hyperframe-6.1.0-py3-none-any.whl
        sha256: b03380493a519fce58ea5af42e4a42317bf9bd425596f7a0835ffce80f1a42e5

  - name: python3-h2
    buildsystem: simple
    build-commands:
      - pip3 install h2-4.3.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/69/b2/119f6e6dcbd96f9069ce9a2665e0146588dc9f88f29549711853645e736a/h2-4.3.0-py3-none-any.whl
        sha256: c438f029a25f7945c69e0ccf0fb951dc3f73a5f6412981daee861431b70e2bdd

  # anyio dependency
  - name: python3-sniffio
    buildsystem: simple
    build-commands:
      - pip3 install sniffio-1.3.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl
        sha256: 2f6da418d1f1e0fddd844478f41680e794e6051915791a034ff65e5f100525a2

  - name: python3-anyio
    buildsystem: simple
    build-commands:
      - pip3 install anyio-4.12.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/38/0e/27be9fdef66e72d64c0cdc3cc2823101b80585f8119b5c112c2e8f5f7dab/anyio-4.12.1-py3-none-any.whl
        sha256: d405828884fc140aa80a3c667b8beed277f1dfedec42ba031bd6ac3db606ab6c

  - name: python3-certifi
    buildsystem: simple
    build-commands:
      - pip3 install certifi-2026.2.25-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/9a/3c/c17fb3ca2d9c3acff52e30b309f538586f9f5b9c9cf454f3845fc9af4881/certifi-2026.2.25-py3-none-any.whl
        sha256: 027692e4402ad994f1c42e52a4997a9763c646b73e4096e4d5d6db8af1d6f0fa

  - name: python3-h11
    buildsystem: simple
    build-commands:
      - pip3 install h11-0.16.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/04/4b/29cac41a4d98d144bf5f6d33995617b185d14b22401f75ca86f384e87ff1/h11-0.16.0-py3-none-any.whl
        sha256: 63cf8bbe7522de3bf65932fda1d9c2772064ffb3dae62d55932da54b31cb6c86

  - name: python3-httpcore
    buildsystem: simple
    build-commands:
      - pip3 install httpcore-1.0.9-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7e/f5/f66802a942d491edb555dd61e3a9961140fd64c90bce1eafd741609d334d/httpcore-1.0.9-py3-none-any.whl
        sha256: 2d400746a40668fc9dec9810239072b40b4484b640a8c38fd654a024c7a1bf55

  # sockio dependency
  - name: python3-flit-core
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/69/59/b6fc2188dfc7ea4f936cd12b49d707f66a1cb7a1d2c16172963534db741b/flit_core-3.12.0.tar.gz
        sha256: 18f63100d6f94385c6ed57a72073443e1a71a4acb4339491615d0f16d6ff01b2

  - name: python3-socksio
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: git
        url: https://github.com/sethmlarson/socksio.git
        commit: b326406915fd98a8185c1c160165c5b8963b30c1

  - name: python3-httpx
    buildsystem: simple
    build-commands:
      - pip3 install httpx-0.28.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/2a/39/e50c7c3a983047577ee07d2a9e53faf5a69493943ec3f6a384bdc792deb2/httpx-0.28.1-py3-none-any.whl
        sha256: d909fcccc110f8c7faf814ca82a9a4d816bc5a6dbfea25d6591d6985b8ba59ad

  # sentry-sdk dependency
  - name: python3-urllib3
    buildsystem: simple
    build-commands:
      - pip3 install urllib3-2.6.3-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/39/08/aaaad47bc4e9dc8c725e68f9d04865dbcb2052843ff09c97b08904852d84/urllib3-2.6.3-py3-none-any.whl
        sha256: bf272323e553dfb2e87d9bfd225ca7b0f467b919d7bbd355436d3fd37cb0acd4

  - name: python3-sentry-sdk
    buildsystem: simple
    build-commands:
      - pip3 install sentry_sdk-2.53.0-py2.py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/47/d4/2fdf854bc3b9c7f55219678f812600a20a138af2dd847d99004994eada8f/sentry_sdk-2.53.0-py2.py3-none-any.whl
        sha256: 46e1ed8d84355ae54406c924f6b290c3d61f4048625989a723fd622aab838899

  - name: python3-typing-extensions
    buildsystem: simple
    build-commands:
      - pip3 install typing_extensions-4.15.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/18/67/36e9267722cc04a6b9f15c7f3441c2363321a3ea07da7ae0c0707beb2a9c/typing_extensions-4.15.0-py3-none-any.whl
        sha256: f0fa19c6845758ab08074a0cfa8b7aecb71c999ca73d62883bc25cc018c4e548

  - name: python3-greenlet
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/a3/51/1664f6b78fc6ebbd98019a1fd730e83fa78f2db7058f72b1463d3612b8db/greenlet-3.3.2.tar.gz
        sha256: 2eaf067fc6d886931c7962e8c6bede15d2f01965560f3359b27c80bde2d151f2

  - name: python3-SQLAlchemy
    buildsystem: simple
    build-commands:
      - pip3 install sqlalchemy-2.0.47-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/15/9f/7c378406b592fcf1fc157248607b495a40e3202ba4a6f1372a2ba6447717/sqlalchemy-2.0.47-py3-none-any.whl
        sha256: e2647043599297a1ef10e720cf310846b7f31b6c841fee093d2b09d81215eb93

  - name: python3-emoji
    buildsystem: simple
    build-commands:
      - pip3 install emoji-2.15.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e1/5e/4b5aaaabddfacfe36ba7768817bd1f71a7a810a43705e531f3ae4c690767/emoji-2.15.0-py3-none-any.whl
        sha256: 205296793d66a89d88af4688fa57fd6496732eb48917a87175a023c8138995eb

  # gssapi dependency
  - name: python3-decorator
    buildsystem: simple
    build-commands:
      - pip3 install decorator-5.2.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/4e/8c/f3147f5c4b73e7550fe5f9352eaa956ae838d5c51eb58e7a25b9f3e2643b/decorator-5.2.1-py3-none-any.whl
        sha256: d316bb415a2d9e2d2b3abcc4084c6502fc09240e292cd76a76afc106a1c8e04a

  # qrcode dependencies
  - name: python3-pypng
    buildsystem: simple
    build-commands:
      - pip3 install pypng-0.20220715.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/3e/b9/3766cc361d93edb2ce81e2e1f87dd98f314d7d513877a342d31b30741680/pypng-0.20220715.0-py3-none-any.whl
        sha256: 4a43e969b8f5aaafb2a415536c1a8ec7e341cd6a3f957fd5b5f32a4cfeed902c

  # OMEMO dependencies
  - name: python3-qrcode
    buildsystem: simple
    build-commands:
      - pip3 install qrcode-8.2-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/dd/b8/d2d6d731733f51684bbf76bf34dab3b70a9148e8f2cef2bb544fccec681a/qrcode-8.2-py3-none-any.whl
        sha256: 16e64e0716c14960108e85d853062c9e8bba5ca8252c0b4d0231b9df4060ff4f

  - name: python3-protobuf
    buildsystem: simple
    build-commands:
      - pip3 install --no-deps protobuf-6.33.5-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/57/bf/2086963c69bdac3d7cff1cc7ff79b8ce5ea0bec6797a017e1be338a46248/protobuf-6.33.5-py3-none-any.whl
        sha256: 69915a973dd0f60f31a08b8318b73eab2bd6a392c79184b3612226b0a3f8ec02

  - name: python3-omemo-dr
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/4f/6c/2e024e615cca6f5e03261cf8fa9f584a5ecd59d3fb7ac7e7bf52f2d9cee1/omemo_dr-1.2.0.tar.gz
        sha256: 18b6542b3bb7ed6dce34dd02f32b16401982ba24f0146ddae091dcb92c79a484

  # nbxmpp dependency (optional)
  - name: python3-gssapi
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/23/52/c1e90623c259a42ab0587078bb04f959867b970add46ff66750ead8fc7c5/gssapi-1.11.1.tar.gz
        sha256: 2049ee4b1d0c363163a1344b7282a363f9f4094e51d2c36de0cf01d4735e0ae2

  - name: python3-nbxmpp
    buildsystem: simple
    build-commands:
      - pip3 install nbxmpp-7.1.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d1/a8/0b09aa5513be31e2297d1c01d0483262f6ec167c7be21a640a11ee528bea/nbxmpp-7.1.0-py3-none-any.whl
        sha256: 2357cb9185b2e97f21c8293b5041bddfd29411c34ebc7b4a4b58e802c122f2ae

  - name: gajim
    buildsystem: simple
    build-commands:
      - ./make.py build --dist=flatpak
      - ./make.py install --dist=flatpak --prefix=/app
      - pip3 install --no-build-isolation .
      - cp -t ${FLATPAK_DEST} app-overrides.json
    sources:
      - type: git
        url: https://dev.gajim.org/gajim/gajim.git
        tag: 2.4.3
      - type: file
        path: app-overrides.json
    post-install:
      - install -d /app/plugins
