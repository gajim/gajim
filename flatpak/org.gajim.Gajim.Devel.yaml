app-id: org.gajim.Gajim.Devel
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: gajim
tags:
  - devel
  - development
  - nightly
finish-args:
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --system-talk-name=org.freedesktop.login1
  - --talk-name=org.mpris.MediaPlayer2.*
  # Automatic status
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.gnome.Mutter.IdleMonitor
  # Keyring
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.kde.kwalletd5
  # Notifications
  - --talk-name=org.freedesktop.Notifications
  # tray/status icon
  - --talk-name=org.kde.StatusNotifierWatcher
  # GnuPG
  - --filesystem=~/.gnupg
  - --filesystem=xdg-run/gnupg
  # gpu acceleration
  - --device=dri
  # extensions
  - --env=PYTHONPATH=/app/plugins/site-packages
  - --env=GI_TYPELIB_PATH=/app/lib/girepository-1.0:/app/plugins/lib/girepository-1.0

add-extensions:
  org.gajim.Gajim.Devel.Plugin:
    directory: plugins
    merge-dirs: lib;site-packages
    add-ld-path: lib
    subdirectories: true
    no-autodownload: true
    autodelete: true

build-options:
  env:
    PIP_PREFIX: /app
    PIP_DISABLE_PIP_VERSION_CHECK: "1"

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/gtk-doc
  - /share/man
  - '*.a'
  - '*.la'

modules:

  - name: python3-pycparser
    buildsystem: simple
    build-commands:
      - pip3 install pycparser-2.23-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a0/e3/59cd50310fc9b59512193629e1984c1f95e5c8ae6e5d8c69532ccc65a7fe/pycparser-2.23-py3-none-any.whl
        sha256: e5c6e8d3fbad53479cab09ac03729e0a9faf2bee3db8208a550daf5af81a5934

  - name: python3-cffi
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/eb/56/b1ba7935a17738ae8453301356628e8147c79dbb825bcbc73dc7401f9846/cffi-2.0.0.tar.gz
        sha256: 44d1b5909021139fe36001ae048dbdde8214afa20200eda0f64c068cac5d5529

  - name: python3-idna
    buildsystem: simple
    build-commands:
      - pip3 install idna-3.11-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/0e/61/66938bbb5fc52dbdf84594873d5b51fb1f7c7794e9c0f5bd885f30bc507b/idna-3.11-py3-none-any.whl
        sha256: 771a87f49d9defaf64091e6e6fe9c18d4833f140bd19464795bc32d966ca37ea

  - name: python3-cryptography
    buildsystem: simple
    only-arches:
      - aarch64
    build-commands:
      - pip3 install cryptography-45.0.7-cp311-abi3-manylinux_2_34_aarch64.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cp311/c/cryptography/cryptography-45.0.7-cp311-abi3-manylinux_2_34_aarch64.whl
        sha256: 8978132287a9d3ad6b54fcd1e08548033cc09dc6aacacb6c004c73c3eb5d3ac3

  - name: python3-cryptography
    buildsystem: simple
    only-arches:
      - x86_64
    build-commands:
      - pip3 install cryptography-45.0.7-cp311-abi3-manylinux_2_34_x86_64.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cp311/c/cryptography/cryptography-45.0.7-cp311-abi3-manylinux_2_34_x86_64.whl
        sha256: b6a0e535baec27b528cb07a119f321ac024592388c5681a5ced167ae98e9fff3

  - name: python3-jeepney
    buildsystem: simple
    build-commands:
      - pip3 install jeepney-0.9.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/b2/a3/e137168c9c44d18eff0376253da9f1e9234d0239e0ee230d2fee6cea8e55/jeepney-0.9.0-py3-none-any.whl
        sha256: 97e5714520c16fc0a45695e5365a2e11b81ea79bba796e26f9f1d178cb182683

  - name: python3-secretstorage
    buildsystem: simple
    build-commands:
      - pip3 install secretstorage-3.4.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/91/ff/2e2eed29e02c14a5cb6c57f09b2d5b40e65d6cc71f45b52e0be295ccbc2f/secretstorage-3.4.0-py3-none-any.whl
        sha256: 0e3b6265c2c63509fb7415717607e4b2c9ab767b7f344a57473b779ca13bd02e

  # jaraco.classes dependency
  - name: python3-more-itertools
    buildsystem: simple
    build-commands:
      - pip3 install more_itertools-10.8.0-py3-none-any.whl
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a4/8e/469e5a4a2f5855992e425f3cb33804cc07bf18d48f2db061aec61ce50270/more_itertools-10.8.0-py3-none-any.whl
        sha256: 52d4362373dcf7c52546bc4af9a86ee7c4579df9a8dc268be0a2f949d376cc9b

  # keyring dependency
  - name: python3-jaraco.classes
    buildsystem: simple
    build-commands:
      - pip3 install jaraco.classes-3.4.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7f/66/b15ce62552d84bbfcec9a4873ab79d993a1dd4edb922cbfccae192bd5b5f/jaraco.classes-3.4.0-py3-none-any.whl
        sha256: f662826b6bed8cace05e7ff873ce0f9283b5c924470fe664fff1c2f00f581790

  - name: python3-jaraco.context
    buildsystem: simple
    build-commands:
      - pip3 install jaraco.context-6.0.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ff/db/0c52c4cf5e4bd9f5d7135ec7669a3a767af21b3a308e1ed3674881e52b62/jaraco.context-6.0.1-py3-none-any.whl
        sha256: f797fc481b490edb305122c9181830a3a5b76d84ef6d1aef2fb9b47ab956f9e4

  - name: python3-jaraco.functools
    buildsystem: simple
    build-commands:
      - pip3 install jaraco_functools-4.3.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/b4/09/726f168acad366b11e420df31bf1c702a54d373a83f968d94141a8c3fde0/jaraco_functools-4.3.0-py3-none-any.whl
        sha256: 227ff8ed6f7b8f62c56deff101545fa7543cf2c8e7b82a7c2116e672f29c26e8

  - name: python3-keyring
    buildsystem: simple
    build-commands:
      - pip3 install keyring-25.6.0-py3-none-any.whl
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d3/32/da7f44bcb1105d3e88a0b74ebdca50c59121d2ddf71c9e34ba47df7f3a56/keyring-25.6.0-py3-none-any.whl
        sha256: 552a3f7af126ece7ed5c89753650eec89c7eaae8617d0aa4d9ad2b75111266bd

  - name: python3-css-parser
    buildsystem: simple
    build-commands:
      - pip3 install css_parser-1.0.10-py2.py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7c/01/4a633580393fa23e17c22f5782886e898c0fdbdb9e77736552a7a12637b5/css_parser-1.0.10-py2.py3-none-any.whl
        sha256: d2e955a114829f0a327cc5535c2e65fe2e40b883b892881017d419a3b6dd05b7

  - name: python3-precis_i18n
    buildsystem: simple
    build-commands:
      - pip3 install precis_i18n-1.1.2-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c3/9b/b68be6845faedb6fa33c4ffda7741467a8e8aabff82c6a941a0ba2785c3d/precis_i18n-1.1.2-py3-none-any.whl
        sha256: 8e6cce33bdd8cb6289b9e85cdd7be74c30a1111cadb9d759492349c8c10b0840

  # GSound dependency
  - shared-modules/libcanberra/libcanberra.json

  - name: gsound
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gsound/1.0/gsound-1.0.3.tar.xz
        sha256: ca2d039e1ebd148647017a7f548862350bc9af01986d39f10cfdc8e95f07881a

  - name: libspelling
    buildsystem: meson
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libspelling/0.4/libspelling-0.4.9.tar.xz
        sha256: d093fd35ae0f1c98fb58876505287fc0a885e47da9d2411d6d7cd595f34d4ebf

  - name: farstream
    rm-configure: true
    sources:
      - type: archive
        url: https://freedesktop.org/software/farstream/releases/farstream/farstream-0.2.9.tar.gz
        sha256: cb7d112433cf7c2e37a8ec918fb24f0ea5cb293cfa1002488e431de26482f47b
      - type: patch
        path: farstream-make-4.3.patch

  # pillow dependency
  - name: python3-pybind11
    buildsystem: simple
    build-commands:
      - pip3 install pybind11-3.0.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cd/8a/37362fc2b949d5f733a8b0f2ff51ba423914cabefe69f1d1b6aab710f5fe/pybind11-3.0.1-py3-none-any.whl
        sha256: aa8f0aa6e0a94d3b64adfc38f560f33f15e589be2175e103c0a33c6bce55ee89

  - name: python3-pillow
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/5a/b0/cace85a1b0c9775a9f8f5d5423c8261c858760e2466c79b2dd184638b056/pillow-12.0.0.tar.gz
        sha256: 87d4f8125c9988bfbed67af47dd7a953e2fc7b0cc1e7800ec6d2080d490bb353

  # httpx dependencies
  - name: python3-truststore
    buildsystem: simple
    build-commands:
      - pip3 install truststore-0.10.4-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/19/97/56608b2249fe206a67cd573bc93cd9896e1efb9e98bce9c163bcdc704b88/truststore-0.10.4-py3-none-any.whl
        sha256: adaeaecf1cbb5f4de3b1959b42d41f6fab57b2b1666adb59e89cb0b53361d981

  # h2 dependencies
  - name: python3-hpack
    buildsystem: simple
    build-commands:
      - pip3 install hpack-4.1.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/07/c6/80c95b1b2b94682a72cbdbfb85b81ae2daffa4291fbfa1b1464502ede10d/hpack-4.1.0-py3-none-any.whl
        sha256: 157ac792668d995c657d93111f46b4535ed114f0c9c8d672271bbec7eae1b496

  - name: python3-hyperframe
    buildsystem: simple
    build-commands:
      - pip3 install hyperframe-6.1.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/48/30/47d0bf6072f7252e6521f3447ccfa40b421b6824517f82854703d0f5a98b/hyperframe-6.1.0-py3-none-any.whl
        sha256: b03380493a519fce58ea5af42e4a42317bf9bd425596f7a0835ffce80f1a42e5

  - name: python3-h2
    buildsystem: simple
    build-commands:
      - pip3 install h2-4.3.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/69/b2/119f6e6dcbd96f9069ce9a2665e0146588dc9f88f29549711853645e736a/h2-4.3.0-py3-none-any.whl
        sha256: c438f029a25f7945c69e0ccf0fb951dc3f73a5f6412981daee861431b70e2bdd

  # anyio dependency
  - name: python3-sniffio
    buildsystem: simple
    build-commands:
      - pip3 install sniffio-1.3.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl
        sha256: 2f6da418d1f1e0fddd844478f41680e794e6051915791a034ff65e5f100525a2

  - name: python3-anyio
    buildsystem: simple
    build-commands:
      - pip3 install anyio-4.11.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/15/b3/9b1a8074496371342ec1e796a96f99c82c945a339cd81a8e73de28b4cf9e/anyio-4.11.0-py3-none-any.whl
        sha256: 0287e96f4d26d4149305414d4e3bc32f0dcd0862365a4bddea19d7a1ec38c4fc

  - name: python3-certifi
    buildsystem: simple
    build-commands:
      - pip3 install certifi-2025.10.5-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e4/37/af0d2ef3967ac0d6113837b44a4f0bfe1328c2b9763bd5b1744520e5cfed/certifi-2025.10.5-py3-none-any.whl
        sha256: 0f212c2744a9bb6de0c56639a6f68afe01ecd92d91f14ae897c4fe7bbeeef0de

  - name: python3-h11
    buildsystem: simple
    build-commands:
      - pip3 install h11-0.16.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/04/4b/29cac41a4d98d144bf5f6d33995617b185d14b22401f75ca86f384e87ff1/h11-0.16.0-py3-none-any.whl
        sha256: 63cf8bbe7522de3bf65932fda1d9c2772064ffb3dae62d55932da54b31cb6c86

  - name: python3-httpcore
    buildsystem: simple
    build-commands:
      - pip3 install httpcore-1.0.9-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7e/f5/f66802a942d491edb555dd61e3a9961140fd64c90bce1eafd741609d334d/httpcore-1.0.9-py3-none-any.whl
        sha256: 2d400746a40668fc9dec9810239072b40b4484b640a8c38fd654a024c7a1bf55

  # sockio dependency
  - name: python3-flit-core
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/69/59/b6fc2188dfc7ea4f936cd12b49d707f66a1cb7a1d2c16172963534db741b/flit_core-3.12.0.tar.gz
        sha256: 18f63100d6f94385c6ed57a72073443e1a71a4acb4339491615d0f16d6ff01b2

  - name: python3-socksio
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: git
        url: https://github.com/sethmlarson/socksio.git
        commit: b326406915fd98a8185c1c160165c5b8963b30c1

  - name: python3-httpx
    buildsystem: simple
    build-commands:
      - pip3 install httpx-0.28.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/2a/39/e50c7c3a983047577ee07d2a9e53faf5a69493943ec3f6a384bdc792deb2/httpx-0.28.1-py3-none-any.whl
        sha256: d909fcccc110f8c7faf814ca82a9a4d816bc5a6dbfea25d6591d6985b8ba59ad

  # sentry-sdk dependency
  - name: python3-urllib3
    buildsystem: simple
    build-commands:
      - pip3 install urllib3-2.5.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl
        sha256: e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc

  - name: python3-sentry-sdk
    buildsystem: simple
    build-commands:
      - pip3 install sentry_sdk-2.43.0-py2.py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/69/31/8228fa962f7fd8814d634e4ebece8780e2cdcfbdf0cd2e14d4a6861a7cd5/sentry_sdk-2.43.0-py2.py3-none-any.whl
        sha256: 4aacafcf1756ef066d359ae35030881917160ba7f6fc3ae11e0e58b09edc2d5d

  - name: python3-typing-extensions
    buildsystem: simple
    build-commands:
      - pip3 install typing_extensions-4.15.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/18/67/36e9267722cc04a6b9f15c7f3441c2363321a3ea07da7ae0c0707beb2a9c/typing_extensions-4.15.0-py3-none-any.whl
        sha256: f0fa19c6845758ab08074a0cfa8b7aecb71c999ca73d62883bc25cc018c4e548

  - name: python3-greenlet
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/03/b8/704d753a5a45507a7aab61f18db9509302ed3d0a27ac7e0359ec2905b1a6/greenlet-3.2.4.tar.gz
        sha256: 0dca0d95ff849f9a364385f36ab49f50065d76964944638be9691e1832e9f86d

  - name: python3-SQLAlchemy
    buildsystem: simple
    build-commands:
      - pip3 install sqlalchemy-2.0.44-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/9c/5e/6a29fa884d9fb7ddadf6b69490a9d45fded3b38541713010dad16b77d015/sqlalchemy-2.0.44-py3-none-any.whl
        sha256: 19de7ca1246fbef9f9d1bff8f1ab25641569df226364a0e40457dc5457c54b05

  - name: python3-emoji
    buildsystem: simple
    build-commands:
      - pip3 install emoji-2.15.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e1/5e/4b5aaaabddfacfe36ba7768817bd1f71a7a810a43705e531f3ae4c690767/emoji-2.15.0-py3-none-any.whl
        sha256: 205296793d66a89d88af4688fa57fd6496732eb48917a87175a023c8138995eb

  # gssapi dependency
  - name: python3-decorator
    buildsystem: simple
    build-commands:
      - pip3 install decorator-5.2.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/4e/8c/f3147f5c4b73e7550fe5f9352eaa956ae838d5c51eb58e7a25b9f3e2643b/decorator-5.2.1-py3-none-any.whl
        sha256: d316bb415a2d9e2d2b3abcc4084c6502fc09240e292cd76a76afc106a1c8e04a

  # qrcode dependencies
  - name: python3-pypng
    buildsystem: simple
    build-commands:
      - pip3 install pypng-0.20220715.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/3e/b9/3766cc361d93edb2ce81e2e1f87dd98f314d7d513877a342d31b30741680/pypng-0.20220715.0-py3-none-any.whl
        sha256: 4a43e969b8f5aaafb2a415536c1a8ec7e341cd6a3f957fd5b5f32a4cfeed902c

  # OMEMO dependencies
  - name: python3-qrcode
    buildsystem: simple
    build-commands:
      - pip3 install qrcode-8.2-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/dd/b8/d2d6d731733f51684bbf76bf34dab3b70a9148e8f2cef2bb544fccec681a/qrcode-8.2-py3-none-any.whl
        sha256: 16e64e0716c14960108e85d853062c9e8bba5ca8252c0b4d0231b9df4060ff4f

  - name: python3-protobuf
    buildsystem: simple
    build-commands:
      - pip3 install --no-deps protobuf-6.33.0-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/07/d1/0a28c21707807c6aacd5dc9c3704b2aa1effbf37adebd8caeaf68b17a636/protobuf-6.33.0-py3-none-any.whl
        sha256: 25c9e1963c6734448ea2d308cfa610e692b801304ba0908d7bfa564ac5132995

  - name: python3-omemo-dr
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: git
        url: https://dev.gajim.org/gajim/omemo-dr.git

  # nbxmpp dependency (optional)
  - name: python3-gssapi
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/b7/bf/95eed332e3911e2b113ceef5e6b0da807b22e45dbf897d8371e83b0a4958/gssapi-1.10.1.tar.gz
        sha256: 7b54335dc9a3c55d564624fb6e25fcf9cfc0b80296a5c51e9c7cf9781c7d295b

  - name: python3-nbxmpp
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: git
        url: https://dev.gajim.org/gajim/python-nbxmpp.git

  - name: gajim
    buildsystem: simple
    build-commands:
      - ./make.py build --dist=flatpak-nightly
      - ./make.py install --dist=flatpak-nightly --prefix=/app
      - pip3 install --no-build-isolation .
      - cp -t ${FLATPAK_DEST} app-overrides.json
    sources:
      - type: git
        url: https://dev.gajim.org/gajim/gajim.git
      - type: file
        path: app-overrides.json
      - type: shell
        commands:
          - mv gajim/data/icons/hicolor/scalable/apps/gajim{-devel,}.svg
    post-install:
      - install -d /app/plugins
